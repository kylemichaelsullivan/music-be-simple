---
globs: **/components/**/*.tsx, **/pages/**/*.tsx
exclude: **/__tests__/**, **/*.test.*, **/*.spec.*
alwaysApply: false
---

# Music Be Simple Component Development Standards

## File Organization

```
src/components/
â”œâ”€â”€ buttons/
â”‚   â”œâ”€â”€ TopButton.tsx
â”‚   â”œâ”€â”€ TransposeButton.tsx
â”‚   â””â”€â”€ UseFlatsButton.tsx
â”œâ”€â”€ displays/
â”‚   â”œâ”€â”€ Displays.tsx
â”‚   â”œâ”€â”€ DisplaySelector.tsx
â”‚   â”œâ”€â”€ DisplaysSelector.tsx
â”‚   â”œâ”€â”€ modes/
â”‚   â”‚   â”œâ”€â”€ Mode.tsx
â”‚   â”‚   â”œâ”€â”€ Modes.tsx
â”‚   â”‚   â””â”€â”€ ModesHeading.tsx
â”‚   â””â”€â”€ instruments/
â”‚       â”œâ”€â”€ Banjo/
â”‚       â”‚   â”œâ”€â”€ Banjo.tsx
â”‚       â”‚   â”œâ”€â”€ DroneString.tsx
â”‚       â”‚   â””â”€â”€ SkippedFret.tsx
â”‚       â”œâ”€â”€ Guitar/
â”‚       â”‚   â””â”€â”€ Guitar.tsx
â”‚       â”œâ”€â”€ Mandolin/
â”‚       â”‚   â””â”€â”€ Mandolin.tsx
â”‚       â”œâ”€â”€ Piano/
â”‚       â”‚   â”œâ”€â”€ Key.tsx
â”‚       â”‚   â””â”€â”€ Piano.tsx
â”‚       â”œâ”€â”€ Ukulele/
â”‚       â”‚   â””â”€â”€ Ukulele.tsx
â”‚       â”œâ”€â”€ Fret.tsx
â”‚       â”œâ”€â”€ FretNumbers.tsx
â”‚       â”œâ”€â”€ FretString.tsx
â”‚       â”œâ”€â”€ Instrument.tsx
â”‚       â”œâ”€â”€ Label.tsx
â”‚       â”œâ”€â”€ Nut.tsx
â”‚       â””â”€â”€ index.tsx
â”œâ”€â”€ nav/
â”‚   â”œâ”€â”€ Navbar.tsx
â”‚   â””â”€â”€ NavTab.tsx
â”œâ”€â”€ AllowedNote.tsx
â”œâ”€â”€ Footer.tsx
â”œâ”€â”€ Icon.tsx
â”œâ”€â”€ Main.tsx
â”œâ”€â”€ Title.tsx
â”œâ”€â”€ Tonic.tsx
â””â”€â”€ Variant.tsx

src/pages/
â”œâ”€â”€ Chords/
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ Chord.tsx
â”‚   â”œâ”€â”€ ChordName.tsx
â”‚   â”œâ”€â”€ ChordNote.tsx
â”‚   â”œâ”€â”€ ChordNotes.tsx
â”‚   â””â”€â”€ Notes.tsx
â”œâ”€â”€ Play/
â”‚   â””â”€â”€ index.tsx
â””â”€â”€ Scales/
    â”œâ”€â”€ index.tsx
    â”œâ”€â”€ Notes.tsx
    â”œâ”€â”€ Scale.tsx
    â””â”€â”€ ScaleContainer.tsx

src/routes/
â”œâ”€â”€ __root.tsx
â”œâ”€â”€ index.tsx
â”œâ”€â”€ chords.tsx
â”œâ”€â”€ play.tsx
â””â”€â”€ scales.tsx
```

## Component Structure Guidelines

### Avoid Superfluous Wrappers

- **Remove unnecessary wrapper divs**: Don't create wrapper divs that add DOM complexity without benefit
- **Simplify component structure**: Remove redundant nesting when possible
- **Keep meaningful wrappers**: Retain wrappers that serve styling, semantic, or organizational purposes

### Spacing Guidelines

- **Avoid `space-*` utilities**: Don't use `space-x-*` or `space-y-*` utilities - they rely on margin-based spacing
- **Use flex/gap spacing**: Use `flex flex-col gap-*` for vertical spacing and `flex items-center gap-*` for horizontal spacing
- **Maintain visual consistency**: All spacing changes should preserve the original visual appearance

#### Spacing Examples

```tsx
// âŒ Avoid - margin-based spacing
<div className='space-y-4'>
  <Component />
</div>

// âœ… Good - flexbox-based spacing
<div className='flex flex-col gap-4'>
  <Component />
</div>
```

```tsx
// âŒ Avoid - redundant wrapper
<div className='Container'>
  <div className='flex flex-col gap-4'>
    <Component />
  </div>
</div>

// âœ… Good - simplified structure
<div className='Container flex flex-col gap-4'>
  <Component />
</div>
```

## Utility Components

Always use the project's utility components instead of creating custom HTML elements when possible:

### Core UI Components

- **Main** (`@/components/Main`) - Main content wrapper component with page-specific styling
  - Required props: `componentName` (string), `children` (ReactNode)
  - Applies page-specific background color based on componentName
  - Provides consistent layout structure

- **Navbar** (`@/components/nav/Navbar`) - Navigation bar component
  - Renders navigation tabs for Scales, Chords, and Play
  - Uses NavTab components for individual tabs

- **NavTab** (`@/components/nav/NavTab`) - Navigation tab component
  - Required props: `title` (TabType), `to` (string)
  - Uses TanStack Router Link for navigation
  - Supports active state styling

- **TopButton** (`@/components/buttons/TopButton`) - Top button component
  - Required props: `title` (string), `icon` (string), `position` ('left' | 'right'), `onFxn` (() => void)
  - Positioned absolutely at top corners
  - Uses emoji icons for visual indicators

#### Example Usage

```tsx
// âœ… Use Main component wrapper
import { Main } from '@/components/Main';
import { Title } from '@/components/Title';

export function Chords() {
  return (
    <Main componentName='Chords'>
      <Title title='Chords' />
    </Main>
  );
}

// âœ… Use TopButton component
import { TopButton } from '@/components/buttons';

<TopButton
  title='Chords'
  icon='ğŸ“–'
  position='left'
  onFxn={() => {}}
/>

// âŒ Don't create custom wrapper when utility exists
<div className='custom-wrapper'>
  <h1>Chords</h1>
</div>
```

## Component Guidelines

### Single-Purpose Components

- **One component per file**: Each file contains exactly one React component
- **Bite-sized components**: Components should be focused and single-purpose (one thing == one component == one file)
- **Descriptive naming**: Use PascalCase with descriptive names indicating visual purpose
- **Component suffixes**: Use appropriate suffixes when needed (e.g., `Container`, `Panel`, `Button`, `Display`)

### Component Structure

```tsx
// Pattern 1: Named export function component (most common)
import { Main } from '@/components/Main';
import type { ReactNode } from 'react';

type ComponentProps = {
	title: string;
	variant?: 'primary' | 'secondary';
	children?: ReactNode;
};

export function ComponentName({
	title,
	variant = 'primary',
	children,
}: ComponentProps) {
	return (
		<Main componentName={title}>
			{children}
		</Main>
	);
}

// Pattern 2: forwardRef component with named export (for DOM refs)
import { forwardRef } from 'react';

const ComponentName = forwardRef<HTMLDivElement, ComponentProps>(
	({ title, variant = 'primary', children }, ref) => {
		return (
			<div
				ref={ref}
				className='ComponentName base-classes'
			>
				{children}
			</div>
		);
	},
);

ComponentName.displayName = 'ComponentName';

export { ComponentName };

// Pattern 3: Memoized component (for performance optimization)
import { Main } from '@/components/Main';
import type { ReactNode } from 'react';
import { memo } from 'react';

function ComponentName({ title, variant = 'primary', children }: ComponentProps) {
	return (
		<div className='ComponentName base-classes'>
			{children}
		</div>
	);
}

export const ComponentName = memo(ComponentName);
```

### Component Guidelines

- **TypeScript types**: Prefer `type` over `interface` for component props and data structures
- **Named exports only**: Export components as named exports using `export function ComponentName` (NO default exports)
- **Import paths**: 
  - Use relative imports (`./` or `../`) for siblings, direct children, or direct parents (NOT root level)
  - Use `@/` alias for all other imports (cross-directory, root level, etc.)
- **Import order**: All imports at top without blank lines:
  1. Internal project imports with `@/` alias (alphabetically: components, context, hooks, instruments, navigation, schemas, stores, utils)
  2. Type imports from `@/types` and other `@/` paths (alphabetically)
  3. React value imports (from 'react')
  4. Third-party libraries (alphabetically: clsx, zod, @tanstack/react-router, etc.)
  5. Relative imports (alphabetically)
  6. Type imports from React (import type from 'react') - comes last
- **Separate code and type imports**: If importing both code and types from the same file, use separate import statements
- **Props interface**: Define clear, typed props with descriptive names
- **forwardRef usage**: Use `forwardRef` for components that need to expose DOM refs
- **Memoization**: Use `memo` for components with stable props to prevent unnecessary re-renders
- **Memoized exports**: Memoized components should have their export at the bottom of the file as a named export

## Component Patterns

### Layout Components

- **Main** (`@/components/Main`) - Main content wrapper component with page-specific styling
- **Navbar** (`@/components/nav/Navbar`) - Navigation bar with tabs for Scales, Chords, and Play
- **NavTab** (`@/components/nav/NavTab`) - Individual navigation tab component
- **Footer** (`@/components/Footer`) - Footer component with copyright information
- **Title** (`@/components/Title`) - Title component for page headings

### Button Components

- **TopButton** (`@/components/buttons/TopButton`) - Top button component for page-specific actions
- **TransposeButton** (`@/components/buttons/TransposeButton`) - Button to transpose scales up or down by a fifth
- **UseFlatsButton** (`@/components/buttons/UseFlatsButton`) - Button to toggle between flats and sharps

### Display Components

- **Displays** (`@/components/displays/Displays`) - Container for instrument displays
- **DisplaySelector** (`@/components/displays/DisplaySelector`) - Individual display selector
- **DisplaysSelector** (`@/components/displays/DisplaysSelector`) - Selector for choosing displays
- **Mode** (`@/components/displays/modes/Mode`) - Individual mode display component
- **Modes** (`@/components/displays/modes/Modes`) - Modes display component
- **ModesHeading** (`@/components/displays/modes/ModesHeading`) - Modes section heading component
- **Instrument** (`@/components/displays/instruments/Instrument`) - Base instrument display component wrapper
- **Banjo, Guitar, Mandolin, Piano, Ukulele** - Specific instrument display components
- **Fret, FretNumbers, FretString, Label, Nut** - Shared fretboard components

### Page Components

All page components follow a similar pattern:

- **Chords** (`@/pages/Chords`) - Chords page for chord-related functionality (named export)
- **Play** (`@/pages/Play`) - Play page for music playback functionality (named export)
- **Scales** (`@/pages/Scales`) - Scales page for scale-related functionality (named export)

## State Management

The project uses a hybrid approach combining Zustand stores and React Context API:

### Zustand Stores

- **useChordsStore** (`@/stores/chordsStore`) - Chords tonic and variant state (sessionStorage)
- **useScalesStore** (`@/stores/scalesStore`) - Scales tonic and variant state (sessionStorage)
- **usePlayStore** (`@/stores/playStore`) - Play functionality state (sessionStorage)

### Context Providers

- **ChordsContext** (`@/context/Chords`) - Chords-specific state (uses chordsStore for tonic/variant, computed notes, chordName, noteCount, showNerdMode) - showNerdMode in localStorage
- **GlobalsContext** (`@/context/Globals`) - Global application state (note display preferences, selected displays, using flats/sharps, audio context, note playback) - uses localStorage
- **InstrumentNotesContext** (`@/context/InstrumentNotes`) - Instrument notes display context
- **PlayContext** (`@/context/Play`) - Play functionality state
- **ScalesContext** (`@/context/Scales`) - Scales-specific state (uses scalesStore for tonic/variant, computed notes, showNoteLabels) - showNoteLabels in localStorage

### Custom Hooks

- **useChords** (`@/hooks/useChords`) - Access chords context
- **useGlobals** (`@/hooks/useGlobals`) - Access global context
- **useInstrumentNotes** (`@/hooks/useInstrumentNotes`) - Access instrument notes context
- **usePlay** (`@/hooks/usePlay`) - Access play context
- **useScales** (`@/hooks/useScales`) - Access scales context

### Using State

```tsx
// âœ… Use context hooks (recommended - provides computed values)
import { Main } from '@/components/Main';
import { useGlobals } from '@/hooks';
import { useScales } from '@/hooks';

export function Scales() {
  const { tonic, variant, notes, handleTonicChange } = useScales();
  const { displays, usingFlats } = useGlobals();
  
  return (
    <Main componentName='Scales'>
      {/* Use state */}
    </Main>
  );
}

// âœ… Use store hooks directly (if you only need tonic/variant)
import { useScalesStore } from '@/stores/scalesStore';

export function MyComponent() {
  const { tonic, variant, setTonic, setVariant } = useScalesStore();
  
  return (
    <div>
      {/* Use store state */}
    </div>
  );
}
```

### Context Provider Pattern

Context providers wrap page components at the route level:

```tsx
// Route file (src/routes/scales.tsx)
import { ScalesContextProvider } from '@/context';
import { Scales } from '@/pages/Scales';
import { createFileRoute } from '@tanstack/react-router';

export function ScalesPage() {
  return (
    <ScalesContextProvider>
      <Scales />
    </ScalesContextProvider>
  );
}

export const Route = createFileRoute('/scales')({
  component: ScalesPage,
});
```

## Component Best Practices

### Performance

- **React.memo**: Use for components with stable props when needed
- **useMemo**: Use for expensive computations
- **useCallback**: Use for event handlers passed as props
- **Lazy loading**: Use `lazy()` and `Suspense` for code splitting page components if needed
- **Tree shaking**: Import only necessary components
- **Context hooks**: Use context hooks to access state efficiently
- **Zustand stores**: Use store hooks directly when you only need tonic/variant state (avoids unnecessary context re-renders)

### Accessibility

- **ARIA labels**: Include appropriate ARIA labels and roles
- **Keyboard navigation**: Support keyboard navigation for interactive elements
- **Focus management**: Implement proper focus management
- **Screen reader compatibility**: Ensure screen reader compatibility
- **Color contrast**: Maintain proper color contrast ratios
- **Semantic HTML**: Use semantic HTML structure (header, main, footer, nav, section, etc.)
- **Image alt text**: Always provide descriptive alt text for images
- **Link titles**: Include descriptive title attributes for links

### Error Handling

- **Defensive programming**: Include validation and fallbacks for data integrity
- **Graceful degradation**: Handle missing data values gracefully
- **Null checks**: Check for null/undefined values before rendering

### Icons

- **Emoji icons**: Use emoji icons for simple visual indicators (e.g., 'ğŸ“–' for TopButton)
- **Icon accessibility**: Include appropriate title attributes for icon buttons
- **Icon sizing**: Icons are sized via className on button elements

## Styling Guidelines

### Tailwind CSS

- **Utility-first**: Use Tailwind utility classes for styling
- **Custom classes**: Use custom CSS classes for complex or reusable patterns
- **Responsive design**: Use Tailwind responsive prefixes (sm:, md:, lg:, xl:)
- **Dark mode**: Support dark mode if configured in Tailwind config

### Class Management

- **clsx**: Use `clsx` for conditional class names
- **Component classes**: Include component name as base class for scoping

```tsx
import clsx from 'clsx';

<div
  className={clsx(
    'ComponentName base-classes',
    condition && 'conditional-classes',
    variant === 'primary' && 'primary-classes',
  )}
>
```

## Typography

- **Typographic apostrophe**: Use ' instead of ' in all user-facing text
- **System fonts**: Uses Inter font family (defined in globals.css)
- **Responsive typography**: Use responsive text size utilities (text-2xl, text-3xl, etc.)

## Routing

- **TanStack Router**: Use TanStack Router for navigation
- **Link component**: Use Link component from `@tanstack/react-router` for navigation
- **Active state**: Use `activeProps` prop on Link for active state styling
- **Route structure**: Routes are defined in `src/routes/` directory

```tsx
import { Link } from '@tanstack/react-router';

<Link
  to='/chords'
  className='px-4 py-2 rounded-t-lg hover:bg-gray-100 transition-colors'
  activeProps={{ className: 'bg-gray-300 font-bold' }}
  title='Chords'
>
  Chords
</Link>
```

## Component Testing

### Unit Testing

- **Component rendering**: Test component rendering with different props
- **User interactions**: Test user interactions and callbacks
- **Accessibility features**: Test accessibility features
- **Data integration**: Test components with different data values

### Integration Testing

- **Page integration**: Test page components within routes
- **Navigation behavior**: Test navigation between pages
- **Responsive behavior**: Test responsive behavior across screen sizes
- **State persistence**: Test context state persistence (localStorage) and store state persistence (sessionStorage) across page navigation

### Testing Commands

- Use `bun dev` for development server
- Use `bun run build` for production build
- Use `bun lint` for linting
- Use `bun format` for formatting code
- Use `bun run test` for running unit and component tests once (CI mode) (Vitest)
- Use `bun run test:watch` for running tests in watch mode (development)
- Use `bun run test:e2e` for running end-to-end tests
- Use `bun run test:all` for running all tests
