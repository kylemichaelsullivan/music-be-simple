---
globs: **/components/**/*.tsx, **/pages/**/*.tsx
exclude: **/__tests__/**, **/*.test.*, **/*.spec.*
alwaysApply: false
---

# Music Be Simple Component Development Standards

## File Organization

```
src/components/
‚îú‚îÄ‚îÄ buttons/
‚îÇ   ‚îú‚îÄ‚îÄ AddButton, CloseButton, EditButton, IconButton, InstrumentButton, RemoveButton
‚îÇ   ‚îú‚îÄ‚îÄ SaveSectionButton, ToggleSaveSectionButton, TopButton, TransposeButton, UseFlatsButton
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ displays/
‚îÇ   ‚îú‚îÄ‚îÄ Displays.tsx
‚îÇ   ‚îú‚îÄ‚îÄ DisplaySelector.tsx
‚îÇ   ‚îú‚îÄ‚îÄ DisplaysSelector.tsx
‚îÇ   ‚îú‚îÄ‚îÄ modes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Mode.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Modes.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ModesHeading.tsx
‚îÇ   ‚îî‚îÄ‚îÄ instruments/
‚îÇ       ‚îú‚îÄ‚îÄ Banjo/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Banjo.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ DroneString.tsx
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ SkippedFret.tsx
‚îÇ       ‚îú‚îÄ‚îÄ Guitar/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Guitar.tsx
‚îÇ       ‚îú‚îÄ‚îÄ Mandolin/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Mandolin.tsx
‚îÇ       ‚îú‚îÄ‚îÄ Piano/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Key.tsx
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Piano.tsx
‚îÇ       ‚îú‚îÄ‚îÄ Ukulele/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Ukulele.tsx
‚îÇ       ‚îú‚îÄ‚îÄ Fret.tsx, FretNumbers.tsx, FretString.tsx, Instrument.tsx, Label.tsx, LabelContent.tsx, Nut.tsx
‚îÇ       ‚îî‚îÄ‚îÄ index.tsx
‚îú‚îÄ‚îÄ nav/
‚îÇ   ‚îú‚îÄ‚îÄ Navbar.tsx
‚îÇ   ‚îî‚îÄ‚îÄ NavTab.tsx
‚îú‚îÄ‚îÄ AllowedNote.tsx, Footer.tsx, Main.tsx, PageLayout.tsx, SkipLink.tsx, Title.tsx, Tonic.tsx, TuningModal.tsx, Variant.tsx
‚îî‚îÄ‚îÄ icons/ (ActionIcon, Icon, InstrumentIcon, NavIcon)

src/pages/
‚îú‚îÄ‚îÄ Chords/ (Chords, Chord, ChordName, ChordNote, ChordNotes, Notes, index.ts)
‚îú‚îÄ‚îÄ Play/ (Play, ChordBin with ChordBinEditor, ChordBinItem, etc.; Notepad; SaveSection with Exports, Imports; InstrumentSelector; index.ts)
‚îî‚îÄ‚îÄ Scales/ (Scales, Notes, Scale, ScaleContainer, index.ts)
```

## Component Structure Guidelines

### Avoid Superfluous Wrappers

- **Remove unnecessary wrapper divs**: Don't create wrapper divs that add DOM complexity without benefit
- **Simplify component structure**: Remove redundant nesting when possible
- **Keep meaningful wrappers**: Retain wrappers that serve styling, semantic, or organizational purposes

### Spacing Guidelines

- **Avoid `space-*` utilities**: Don't use `space-x-*` or `space-y-*` utilities - they rely on margin-based spacing
- **Use flex/gap spacing**: Use `flex flex-col gap-*` for vertical spacing and `flex items-center gap-*` for horizontal spacing
- **Maintain visual consistency**: All spacing changes should preserve the original visual appearance

#### Spacing Examples

```tsx
// ‚ùå Avoid - margin-based spacing
<div className='space-y-4'>
  <Component />
</div>

// ‚úÖ Good - flexbox-based spacing
<div className='flex flex-col gap-4'>
  <Component />
</div>
```

```tsx
// ‚ùå Avoid - redundant wrapper
<div className='Container'>
  <div className='flex flex-col gap-4'>
    <Component />
  </div>
</div>

// ‚úÖ Good - simplified structure
<div className='Container flex flex-col gap-4'>
  <Component />
</div>
```

## Utility Components

Always use the project's utility components instead of creating custom HTML elements when possible:

### Core UI Components

- **Main** (`@/components/Main`) - Main content wrapper component with page-specific styling
  - Required props: `componentName` (string), `children` (ReactNode)
  - Applies page-specific background color based on componentName
  - Provides consistent layout structure

- **Navbar** (`@/components/nav/Navbar`) - Navigation bar component
  - Renders navigation tabs for Scales, Chords, and Play
  - Uses NavTab components for individual tabs

- **NavTab** (`@/components/nav/NavTab`) - Navigation tab component
  - Required props: `title` (TabType), `isActive` (boolean), `onFxn` (() => void)
  - Uses button element for navigation with click handler
  - Supports active state styling via `isActive` prop

- **TopButton** (`@/components/buttons/TopButton`) - Top button component
  - Required props: `title` (string), `icon` (string), `position` ('left' | 'right'), `onFxn` (() => void)
  - Positioned absolutely at top corners
  - Uses emoji icons for visual indicators

#### Example Usage

```tsx
// ‚úÖ Use Main component wrapper
import { Main } from '@/components/Main';
import { Title } from '@/components/Title';

export function Chords() {
  return (
    <Main componentName='Chords'>
      <Title title='Chords' />
    </Main>
  );
}

// ‚úÖ Use TopButton component
import { TopButton } from '@/components/buttons';

<TopButton
  title='Chords'
  icon='üìñ'
  position='left'
  onFxn={() => {}}
/>

// ‚ùå Don't create custom wrapper when utility exists
<div className='custom-wrapper'>
  <h1>Chords</h1>
</div>
```

## Component Guidelines

### Single-Purpose Components

- **One component per file**: Each file contains exactly one React component
- **Bite-sized components**: Components should be focused and single-purpose (one thing == one component == one file)
- **Descriptive naming**: Use PascalCase with descriptive names indicating visual purpose
- **Component suffixes**: Use appropriate suffixes when needed (e.g., `Container`, `Panel`, `Button`, `Display`)

### Component Structure

```tsx
// Pattern 1: Named export function component (most common)
import { Main } from '@/components/Main';
import type { ReactNode } from 'react';

type ComponentProps = {
	title: string;
	variant?: 'primary' | 'secondary';
	children?: ReactNode;
};

export function ComponentName({
	title,
	variant = 'primary',
	children,
}: ComponentProps) {
	return (
		<Main componentName={title}>
			{children}
		</Main>
	);
}

// Pattern 2: forwardRef component with named export (for DOM refs)
import { forwardRef } from 'react';

const ComponentName = forwardRef<HTMLDivElement, ComponentProps>(
	({ title, variant = 'primary', children }, ref) => {
		return (
			<div
				className='ComponentName base-classes'
				ref={ref}
			>
				{children}
			</div>
		);
	},
);

ComponentName.displayName = 'ComponentName';

export { ComponentName };

// Pattern 3: Memoized component (for performance optimization)
import { Main } from '@/components/Main';
import type { ReactNode } from 'react';
import { memo } from 'react';

function ComponentName({ title, variant = 'primary', children }: ComponentProps) {
	return (
		<div className='ComponentName base-classes'>
			{children}
		</div>
	);
}

export const ComponentName = memo(ComponentName);
```

### Component Guidelines

- **TypeScript types**: Prefer `type` over `interface` for component props and data structures
- **Named exports only**: Export components as named exports using `export function ComponentName` (NO default exports)
- **Import paths**: 
  - Use relative imports (`./` or `../`) for siblings, direct children, or direct parents (NOT root level)
  - Use `@/` alias for all other imports (cross-directory, root level, etc.)
- **Import order**: All imports at top without blank lines:
  1. Internal project imports with `@/` alias (alphabetically: components, context, hooks, instruments, navigation, schemas, stores, utils)
  2. Type imports from `@/types` and other `@/` paths (alphabetically)
  3. React value imports (from 'react')
  4. Third-party libraries (alphabetically: clsx, zod, etc.)
  5. Relative imports (alphabetically)
  6. Type imports from React (import type from 'react') - comes last
- **Separate code and type imports**: If importing both code and types from the same file, use separate import statements
- **Props interface**: Define clear, typed props with descriptive names
- **forwardRef usage**: Use `forwardRef` for components that need to expose DOM refs
- **Memoization**: Use `memo` for components with stable props to prevent unnecessary re-renders
- **Memoized exports**: Memoized components should have their export at the bottom of the file as a named export

## Component Patterns

### Layout Components

- **Main** (`@/components/Main`) - Main content wrapper with page-specific styling
- **PageLayout** (`@/components/PageLayout`) - Page layout wrapper (e.g. for Play)
- **Navbar**, **NavTab** - Navigation (Scales, Chords, Play)
- **Footer**, **Title**
- **SkipLink** (`@/components/SkipLink`) - Skip-to-content link for accessibility
- **TuningModal** (`@/components/TuningModal`) - Modal to edit instrument tunings (via TuningsContext)

### Button Components

- **TopButton** (`@/components/buttons/TopButton`) - Top button for page-specific actions (icon: string | ReactNode)
- **TransposeButton** - Transpose scales up or down by a fifth
- **UseFlatsButton** - Toggle flats/sharps
- **AddButton**, **CloseButton**, **EditButton**, **IconButton**, **InstrumentButton**, **RemoveButton** - Shared action buttons
- **SaveSectionButton**, **ToggleSaveSectionButton** - Save/Import/Export section on Play page

### Display Components

- **Displays** (`@/components/displays/Displays`) - Container for instrument displays
- **DisplaySelector** (`@/components/displays/DisplaySelector`) - Individual display selector
- **DisplaysSelector** (`@/components/displays/DisplaysSelector`) - Selector for choosing displays
- **Mode** (`@/components/displays/modes/Mode`) - Individual mode display component
- **Modes** (`@/components/displays/modes/Modes`) - Modes display component
- **ModesHeading** (`@/components/displays/modes/ModesHeading`) - Modes section heading component
- **Instrument** (`@/components/displays/instruments/Instrument`) - Base instrument display component wrapper
- **Banjo, Guitar, Mandolin, Piano, Ukulele** - Specific instrument display components
- **Fret, FretNumbers, FretString, Label, LabelContent, Nut** - Shared fretboard components

### Page Components

- **Chords** (`@/pages/Chords`) - Chords page (tonic, variant, chord name, instrument displays)
- **Play** (`@/pages/Play`) - Play page: instrument selector, Chord Bin (add/edit/remove chord items with per-instrument editors), Notepad (reorderable lines, react-dnd), SaveSection (Import/Export JSON)
- **Scales** (`@/pages/Scales`) - Scales page (tonic, variant, modes, instrument displays)

## State Management

The project uses a hybrid approach combining Zustand stores and React Context API:

### Zustand Stores

- **useChordsStore** (`@/stores/chordsStore`) - Chords tonic and variant state (sessionStorage)
- **useScalesStore** (`@/stores/scalesStore`) - Scales tonic and variant state (sessionStorage)
- **usePlayStore** (`@/stores/playStore`) - Play functionality state (sessionStorage)

### Context Providers

`AppProviders` (`@/context/AppProviders`) composes all providers in order: Globals ‚Üí Tunings ‚Üí Scales ‚Üí Chords ‚Üí Play. `InstrumentNotesProvider` is used in `Displays` when rendering instruments.

- **GlobalsContext** (`@/context/Globals`) - Global state (displays, usingFlats, audio context, note playback) - localStorage
- **TuningsContext** (`@/context/Tunings`) - Custom instrument tunings, TuningModal (openTuningModal, closeTuningModal, getTuning, setTuning, resetTuning) - localStorage
- **ScalesContext** (`@/context/Scales`) - Scales state (scalesStore, notes, showNoteLabels) - showNoteLabels in localStorage
- **ChordsContext** (`@/context/Chords`) - Chords state (chordsStore, notes, chordName, noteCount, showNerdMode) - showNerdMode in localStorage
- **PlayContext** (`@/context/Play`) - Play state (Chord Bin, Notepad, Save/Import/Export, note playback)
- **InstrumentNotesContext** (`@/context/InstrumentNotes`) - Instrument notes display (`InstrumentNotesProvider` in `Displays` when rendering instruments)

### Custom Hooks

- **useChords**, **useGlobals**, **useInstrumentNotes**, **usePlay**, **useScales**, **useTunings** - Access their contexts
- **useDragDropClassName**, **useDraggableItem**, **useDropZone** - Drag-and-drop (react-dnd) for Notepad reordering, etc.

### Using State

```tsx
// ‚úÖ Use context hooks (recommended - provides computed values)
import { Main } from '@/components/Main';
import { useGlobals } from '@/hooks';
import { useScales } from '@/hooks';

export function Scales() {
  const { tonic, variant, notes, handleTonicChange } = useScales();
  const { displays, usingFlats } = useGlobals();
  
  return (
    <Main componentName='Scales'>
      {/* Use state */}
    </Main>
  );
}

// ‚úÖ Use store hooks directly (if you only need tonic/variant)
import { useScalesStore } from '@/stores/scalesStore';

export function MyComponent() {
  const { tonic, variant, setTonic, setVariant } = useScalesStore();
  
  return (
    <div>
      {/* Use store state */}
    </div>
  );
}
```

### Context Provider Pattern

`App.tsx` uses `AppProviders`, which composes Globals ‚Üí Tunings ‚Üí Scales ‚Üí Chords ‚Üí Play. `InstrumentNotesProvider` wraps instrument displays in `Displays`.

```tsx
// App.tsx
import { AppProviders } from '@/context';

export function App() {
  return (
    <AppProviders>
      {/* Navbar, active page (Scales | Chords | Play), Footer */}
    </AppProviders>
  );
}
```

## Component Best Practices

### Performance

- **React.memo**: Use for components with stable props when needed
- **useMemo**: Use for expensive computations
- **useCallback**: Use for event handlers passed as props
- **Lazy loading**: Use `lazy()` and `Suspense` for code splitting page components if needed
- **Tree shaking**: Import only necessary components
- **Context hooks**: Use context hooks to access state efficiently
- **Zustand stores**: Use store hooks directly when you only need tonic/variant state (avoids unnecessary context re-renders)

### Accessibility

- **ARIA labels**: Include appropriate ARIA labels and roles
- **Keyboard navigation**: Support keyboard navigation for interactive elements
- **Focus management**: Implement proper focus management
- **Screen reader compatibility**: Ensure screen reader compatibility
- **Color contrast**: Maintain proper color contrast ratios
- **Semantic HTML**: Use semantic HTML structure (header, main, footer, nav, section, etc.)
- **Image alt text**: Always provide descriptive alt text for images
- **Link titles**: Include descriptive title attributes for links

### Error Handling

- **Defensive programming**: Include validation and fallbacks for data integrity
- **Graceful degradation**: Handle missing data values gracefully
- **Null checks**: Check for null/undefined values before rendering

### Icons

- **Emoji icons**: Use emoji icons for simple visual indicators (e.g., 'üìñ' for TopButton)
- **Icon accessibility**: Include appropriate title attributes for icon buttons
- **Icon sizing**: Icons are sized via className on button elements

## Styling Guidelines

### Tailwind CSS

- **Utility-first**: Use Tailwind utility classes for styling
- **Custom classes**: Use custom CSS classes for complex or reusable patterns
- **Responsive design**: Use Tailwind responsive prefixes (sm:, md:, lg:, xl:)
- **Dark mode**: Support dark mode if configured in Tailwind config

### Class Management

- **clsx**: Use `clsx` for conditional class names
- **Component classes**: Include component name as base class for scoping

```tsx
import clsx from 'clsx';

<div
  className={clsx(
    'ComponentName base-classes',
    condition && 'conditional-classes',
    variant === 'primary' && 'primary-classes',
  )}
>
```

## Typography

- **Typographic apostrophe**: Use ' instead of ' in all user-facing text
- **System fonts**: Uses Inter font family (defined in globals.css)
- **Responsive typography**: Use responsive text size utilities (text-2xl, text-3xl, etc.)

## Routing

The application uses manual routing implemented in `App.tsx` with React state and browser History API:

- **Manual routing**: Routes are managed via state in `App.tsx`
- **URL synchronization**: URL is updated using `window.history.pushState` and `window.history.replaceState`
- **Browser navigation**: Handles browser back/forward with `popstate` event listener
- **Navigation components**: Use button elements with handler functions (e.g., `onFxn`) for navigation
- **Active state**: Active tab state is managed via props passed to navigation components

```tsx
// Navigation is handled via click handlers in NavTab component
<NavTab
  title='Chords'
  isActive={currentTab === 'Chords'}
  onFxn={() => onTabChange('Chords')}
/>
```

## Component Testing

### Unit Testing

- **Component rendering**: Test component rendering with different props
- **User interactions**: Test user interactions and callbacks
- **Accessibility features**: Test accessibility features
- **Data integration**: Test components with different data values

### Integration Testing

- **Page integration**: Test page components within routes
- **Navigation behavior**: Test navigation between pages
- **Responsive behavior**: Test responsive behavior across screen sizes
- **State persistence**: Test context state persistence (localStorage) and store state persistence (sessionStorage) across page navigation

### Testing Commands

- Use `bun dev` for development server
- Use `bun run build` for production build
- Use `bun lint` for linting
- Use `bun format` for formatting code
- Use `bun run test` for running unit and component tests once (CI mode) (Vitest)
- Use `bun run test:watch` for running tests in watch mode (development)
- Use `bun run test:e2e` for running end-to-end tests
- Use `bun run test:all` for running all tests
