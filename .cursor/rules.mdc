---
alwaysApply: true
---

# Music Be Simple Project Rules

## Core Principles

- Write and review code like a senior developer
- Challenge erroneous assumptions and inefficiencies
- Always use **bun** for package management and all package-related operations
- Prefer `bun run build` over `bun dev` for compilation
- Use **TypeScript** with strict configuration
- Follow **React 18** with **Vite** architecture
- Use **TanStack Router** for routing
- Use **React Context API** for state management with custom hooks
- Use typographic apostrophe ' instead of straight apostrophe ' in ALL user-facing text

## Package Management

- **Package Manager**: **bun** (always use bun for all package-related operations)
- **Build Command**: `bun build` (TypeScript compilation + Vite build)
- **Development Command**: `bun dev` (Vite dev server with HMR)
- **Lock File**: `bun.lock`

## Development Scripts

### Development Commands

- **Development Server**: `bun dev` (Vite dev server with HMR)
- **Production Build**: `bun build` (TypeScript compilation + Vite build)
- **Preview Build**: `bun preview` (Preview production build locally)
- **Linting**: `bun lint` (Run Biome linter)
- **Lint Fix**: `bun lint:fix` (Run Biome linter and auto-fix)
- **Formatting**: `bun format` (Format code with Biome)
- **Format Check**: `bun format:check` (Check code format)
- **Check All**: `bun check` (Run Biome formatter + linter)
- **Check All Fix**: `bun check:write` (Run Biome formatter + linter and auto-fix)

### Vite Benefits

- **Fast HMR**: Hot Module Replacement for instant updates
- **Optimized builds**: Production builds with code splitting
- **TypeScript support**: Native TypeScript support
- **Plugin ecosystem**: Rich plugin ecosystem (React, Tailwind, TanStack Router)

## Project Structure

```
src/
├── components/          # React components
│   ├── buttons/         # Button components
│   │   ├── TopButton.tsx
│   │   └── UseFlatsButton.tsx
│   ├── displays/        # Display components
│   │   ├── Displays.tsx
│   │   ├── DisplaySelector.tsx
│   │   ├── DisplaysSelector.tsx
│   │   ├── Modes.tsx
│   │   └── instruments/ # Instrument display components
│   │       ├── Instrument.tsx
│   │       ├── Guitar.tsx
│   │       ├── Piano.tsx
│   │       ├── Banjo.tsx
│   │       ├── Mandolin.tsx
│   │       └── Ukulele.tsx
│   ├── nav/             # Navigation components
│   │   ├── Navbar.tsx
│   │   └── NavTab.tsx
│   ├── Footer.tsx       # Footer component
│   ├── Icon.tsx         # Icon component
│   ├── Main.tsx         # Main content wrapper component
│   └── Title.tsx        # Title component
├── context/             # React Context providers
│   ├── Chords/          # Chords context provider
│   ├── Globals/         # Global context provider
│   ├── Play/            # Play context provider
│   ├── Scales/          # Scales context provider
│   ├── shared/          # Shared context utilities
│   └── index.ts         # Context exports
├── hooks/               # Custom React hooks
│   ├── useButtonHandler.ts
│   ├── useChords.ts
│   ├── useGlobals.ts
│   ├── usePlay.ts
│   └── useScales.ts
├── pages/               # Page components
│   ├── Chords/
│   │   └── index.tsx    # Chords page
│   ├── Play/
│   │   └── index.tsx    # Play page
│   └── Scales/
│       └── index.tsx    # Scales page
├── routes/              # TanStack Router route definitions
│   ├── __root.tsx       # Root route layout
│   ├── index.tsx        # Home/index route (redirects to scales)
│   ├── chords.tsx       # Chords route with context provider
│   ├── play.tsx         # Play route with context provider
│   └── scales.tsx       # Scales route with context provider
├── store/               # State management (legacy/unused)
│   └── appStore.ts      # Zustand store with persistence
├── types/               # TypeScript type definitions
│   ├── chords.ts
│   ├── globals.ts
│   ├── index.ts
│   ├── play.ts
│   └── scales.ts
├── utils/               # Utility functions
│   ├── chords.ts
│   ├── notes.ts
│   └── scales.ts
├── main.tsx             # Application entry point
├── navigation.ts        # Navigation constants and schemas
├── instruments.ts       # Instrument definitions
├── globals.css          # Global styles and CSS variables
└── routeTree.gen.ts     # Generated route tree (auto-generated)
```

## Code Organization

### Import Organization

- **Defined order**: Follow specific import order, then alphabetize within each group
- **Import order**:
  1. Type imports (alphabetically by path, including React types)
  2. React value imports (from 'react')
  3. Third-party libraries (alphabetically by source)
  4. Internal project imports (alphabetically by path)
- **Avoid React namespace**: Import React types directly, avoid `React.` prefix
- **Default imports**: Use default imports for components, named imports for hooks and utilities

#### Import Order Example

```tsx
// 1. Type imports (alphabetically by path)
import type { ReactNode } from 'react';
import type { TabType } from '@/types';

// 2. React value imports
import { useState } from 'react';

// 3. Third-party libraries (alphabetically by source)
import { Link } from '@tanstack/react-router';
import clsx from 'clsx';

// 4. Internal project imports (alphabetically by path)
import Main from '@/components/Main';
import { useScales } from '@/hooks/useScales';
```

### File Structure

```tsx
// Standard component file structure (default export pattern)
import type { ReactNode } from 'react';
import { useState } from 'react';

import Main from '@/components/Main';
import { useScales } from '@/hooks/useScales';

// Default export pattern (current working pattern)
export default function ComponentName() {
	const [localState, setLocalState] = useState('');
	const { tonic, variant, notes } = useScales();

	return (
		<Main componentName='ComponentName'>
			{/* Component content */}
		</Main>
	);
}

// Alternative: Component with props
type ComponentProps = {
	// Required props
	title: string;
	// Optional props with defaults
	variant?: 'primary' | 'secondary';
	size?: 'sm' | 'md' | 'lg';
	disabled?: boolean;
	// Children
	children?: ReactNode;
};

export default function ComponentName({
	title,
	variant = 'primary',
	children,
}: ComponentProps) {
	return (
		<div className='ComponentName'>
			{/* Component content */}
		</div>
	);
}
```

## Styling Guidelines

### CSS and Styling

- **Avoid Tailwind margin/space classes**: Do not use `space-x-*` or `space-y-*` utilities - use flex/gap instead
- **Use flex/gap spacing**: Use `flex flex-col gap-*` for vertical spacing and `flex items-center gap-*` for horizontal spacing
- **No !important declarations**: Avoid using `!important` in CSS
- **CSS variables**: Use CSS variables for colors and fonts (defined in globals.css)
- **Tailwind utilities**: Use Tailwind utility classes for styling
- **Custom CSS**: Use custom CSS classes for complex or reusable patterns (accordion, metronome, etc.)

### Spacing Examples

```tsx
// ❌ Avoid - margin-based spacing
<div className='space-y-4'>
  <Component />
</div>

// ✅ Good - flexbox-based spacing
<div className='flex flex-col gap-4'>
  <Component />
</div>
```

### React Best Practices

- **TypeScript**: Avoid using `any` type, prefer proper typing
- **Default exports**: Use default exports for components (e.g., `export default function ComponentName`)
- **Path aliases**: Use `@/` alias for imports (configured in tsconfig.json)
- **State management**: Use React Context API with custom hooks for global state, `useState` for local component state
- **Router integration**: Components should work seamlessly with TanStack Router

## Data Management

### State Management

The project uses **React Context API** for state management with custom hooks:

- **Context providers**: Separate context providers for Chords, Scales, Play, and Globals
- **Provider location**: Context providers are in `src/context/` directory
- **Provider usage**: Context providers wrap page components at the route level
- **Custom hooks**: Use custom hooks (`useChords`, `useScales`, `usePlay`, `useGlobals`) to access context values
- **Persistence**: Local storage persistence via `useLocalStorage` hook in shared context utilities
- **Type safety**: All context values are typed with TypeScript

### Context Structure

- **GlobalsContext**: Global application state (note display preferences, selected displays, etc.)
- **ScalesContext**: Scales-specific state (tonic, variant, notes, display options)
- **ChordsContext**: Chords-specific state (tonic, variant, notes, chord info)
- **PlayContext**: Play functionality state (audio context, note playing)

### State Usage

```tsx
// ✅ Use context hooks
import { useScales } from '@/hooks/useScales';
import { useGlobals } from '@/hooks/useGlobals';

function Component() {
	const { tonic, variant, notes, handleTonicChange } = useScales();
	const { displays, usingFlats } = useGlobals();
	
	// Use state
	return <div>{notes.map(note => /* render */)}</div>;
}
```

### Context Provider Pattern

```tsx
// Route file wraps page with context provider
import { ScalesContextProvider } from '@/context';
import Scales from '@/pages/Scales';

function ScalesPage() {
	return (
		<ScalesContextProvider>
			<Scales />
		</ScalesContextProvider>
	);
}
```

## Routing

### TanStack Router

- **File-based routing**: Routes are defined in `src/routes/` directory
- **Route generation**: Route tree is auto-generated via TanStack Router plugin
- **Route structure**: Each route file exports a route definition
- **Root route**: `__root.tsx` defines the root layout with Navbar and Outlet
- **Navigation**: Use `Link` component from `@tanstack/react-router` for navigation

### Routing Usage

```tsx
// ✅ Use TanStack Router Link
import { Link } from '@tanstack/react-router';

<Link
	to='/chords'
	className='...'
	activeProps={{ className: '...' }}
>
	Chords
</Link>
```

## Comments and Documentation

### Comment Guidelines

- **Minimal comments**: Limit comments to non-obvious functionality
- **Purpose comments**: Comment on oddities that have non-obvious purposes
- **Self-documenting code**: Write code that explains itself through clear naming and structure
- **JSDoc**: Use JSDoc comments for complex props and functions

## Communication Standards

### Progress Updates

- **Meaningful updates only**: Avoid inane progress updates and status reports
- **Focus on substance**: Communicate actual progress, blockers, or decisions that matter
- **No busy work updates**: Don't report on routine tasks or obvious progress
- **Context matters**: Provide context when updates are necessary
- **Efficiency**: Respect time by being concise and relevant

### Documentation Standards

- **Documentation directory**: Place all MD documentation in appropriate directories
- **Usage examples**: Provide clear usage examples
- **Props documentation**: Document all props with types and descriptions
- **Data structure documentation**: Document data file structure and usage

### Documentation Updates

- **Substantive changes only**: Update documentation for meaningful changes
- **Avoid trivial updates**: Don't update docs for minor formatting or obvious changes
- **Focus on value**: Document decisions, patterns, and changes that provide value
- **Clear purpose**: Ensure documentation updates serve a clear purpose
